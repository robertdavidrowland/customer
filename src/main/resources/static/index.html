<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="../../favicon.ico">

    <title>Customer UI</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
          integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.css">
    <link rel="stylesheet" href="/css/customers.css">

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
            integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
            integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
            crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.js"></script>

    <script>
        $(document).ready(function () {
            var table = $('#customers').DataTable({
                "ajax": {
                    "url": "/api/customer/",
                    "dataSrc": ""
                },
                "columns": [
                    {
                        "className": 'details-control',
                        "orderable": false,
                        "data": null,
                        "defaultContent": ''
                    },
                    {"data": "id"},
                    {"data": "firstName"},
                    {"data": "lastName"},
                    {"data": "status"},
                    {"data": "creationDate"}
                ],
                "order": [[1, 'asc']]
            });

            // event listener for opening and closing details
            $('#customers tbody').on('click', 'td.details-control', function () {
                var tr = $(this).closest('tr');
                var row = table.row(tr);

                if (row.child.isShown()) {
                    // This row is already open - close it
                    row.child.hide();
                    tr.removeClass('shown');
                }
                else {
                    // Open this row
                    row.child(formatNotes(row.data())).show();
                    tr.addClass('shown');
                }
            });

            $('#customers').on('click', ".edit-btn", function () {
                var tdButton = $(this).closest('td');

                tdButton.html('<input type="button" id="\' + saveBtnId + \'" class = "save-btn" value="Save" /><input type="button" id="\' + cancelBtnId + \'" class = "cancel-btn" value="Cancel" />');

                var tdNote = tdButton.prev();
                tdNote.html('<input type="text" value="' + tdNote.text() + '"><input type="hidden" value="' + tdNote.text() + '">');
            });

            $('#customers').on('click', '.save-btn', function () {
                var tdButton = $(this).closest('td');
                tdButton.html('<input type="button" id="\' + editBtnId + \'" class="edit-btn" value="Edit" />');

                var tdNote = tdButton.prev();
                tdNote.html(tdNote.children(":text").val());
            });

            $('#customers').on('click', '.cancel-btn', function () {
                var tdButton = $(this).closest('td');
                tdButton.html('<input type="button" id="\' + editBtnId + \'" class="edit-btn" value="Edit" />');

                var tdNote = tdButton.prev();
                tdNote.html(tdNote.children(":hidden").val())
            });
        });

        function formatNotes(data) {
            var formattedNotes = '<table class="details" cellpadding="5" cellspacing="0" border="0">' +
                '<tr><td>Notes:</td></tr>';

            $.each(data.customerNotes, function (i, note) {
                var noteId = 'customerNotes-' + note.id;
                var editBtnId = 'customerNotesEditBtn-' + note.id;
                var saveBtnId = 'customerNotesSaveBtn-' + note.id;
                var cancelBtnId = 'customerNotesCancelBtn-' + note.id;

                formattedNotes += '<tr><td class="notes" id="' + noteId + '">' + note.text + '</td><td class="notes-btns"><input type="button" id="\' + editBtnId + \'" class="edit-btn" value="Edit" /></td></tr>';
            });

            formattedNotes += '</table>';

            return formattedNotes;
        }

    </script>
</head>

<body>
<div class="container">
    <div class="content">
        <h2>Customer UI</h2>
        <div>
            <table id="customers" class="display" style="width:100%">
                <thead>
                <tr>
                    <th></th>
                    <th>Customer Id</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Status</th>
                    <th>Creation Date/Time</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                    <th></th>
                    <th>Customer Id</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Status</th>
                    <th>Creation Date/Time</th>
                </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
</body>
</html>